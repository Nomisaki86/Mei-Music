<UserControl x:Class="Mei_Music.CreatePlaylistCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Width="380" Height="430">
    <Border x:Name="CardBorder" Background="White" Padding="0" ClipToBounds="False">
        <Border.Effect>
            <DropShadowEffect BlurRadius="24" ShadowDepth="4" Opacity="0.35" Color="Black" Direction="270"/>
        </Border.Effect>
        <Grid>
            <Grid.Resources>
                <!-- Single resource for close-button inset: top and right distance from card edge (change here to adjust both). -->
                <Thickness x:Key="HeaderCloseInset">0,12,12,0</Thickness>
                
                <!-- Button Brushes (Clicking these gives you a color picker in Visual Studio Properties!) -->
                <SolidColorBrush x:Key="CreateButtonNormalBrush" Color="#FF565C69"/>
                <SolidColorBrush x:Key="CreateButtonHoverBrush" Color="#FF474658"/>
                <SolidColorBrush x:Key="CreateButtonDisabledBrush" Color="#E5939EAA"/>
                
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" MinHeight="56"/>
                <RowDefinition Height="12"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="20"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="16"/>
                <RowDefinition Height="44"/>
                <RowDefinition Height="20"/>
            </Grid.RowDefinitions>

            <!-- Top banner: full-width drag region with close btn and title; entire area is draggable -->
            <Border x:Name="HeaderDragBorder" Grid.Row="0" Background="White" Cursor="Arrow" ClipToBounds="False"
                    MouseLeftButtonDown="HeaderDragBorder_MouseLeftButtonDown"
                    MouseMove="HeaderDragBorder_MouseMove"
                    MouseLeftButtonUp="HeaderDragBorder_MouseLeftButtonUp">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Button x:Name="CloseButton" Grid.Row="0"
                            BorderThickness="0" Cursor="Hand" Padding="12,12"
                            Margin="{StaticResource HeaderCloseInset}"
                            HorizontalAlignment="Right" VerticalAlignment="Top"
                            Click="CloseButton_Click">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="CloseBtnBorder" Background="Transparent" Padding="{TemplateBinding Padding}">
                                    <Image x:Name="CloseIcon" Source="pack://application:,,,/Resources/Images/close.png" Stretch="Uniform"
                                           Width="18" Height="18" HorizontalAlignment="Center" VerticalAlignment="Center"
                                           Opacity="0.5"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="CloseIcon" Property="Opacity" Value="0.7"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    <TextBlock Grid.Row="1" Text="Create Playlist" FontWeight="Bold" FontSize="16" Foreground="#333333"
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Margin="24,4,24,4" TextWrapping="NoWrap"/>
                </Grid>
            </Border>

            <!-- Image Selector Container -->
            <Border x:Name="ImageSelectorContainer" Grid.Row="2" Width="140" Height="140" 
                    Background="#F0F2F5" CornerRadius="16" Cursor="Hand"
                    HorizontalAlignment="Center" ClipToBounds="True"
                    MouseLeftButtonDown="ImageSelector_Click"
                    MouseEnter="ImageSelector_MouseEnter"
                    MouseLeave="ImageSelector_MouseLeave">
                <!-- Apply OpacityMask to the Grid so both the Image and Hover Overlay inherit the exact CornerRadius -->
                <Grid>
                    <Grid.OpacityMask>
                        <VisualBrush>
                            <VisualBrush.Visual>
                                <Border Background="Black" Width="140" Height="140" CornerRadius="16"/>
                            </VisualBrush.Visual>
                        </VisualBrush>
                    </Grid.OpacityMask>
                    
                    <!-- Actual Image -->
                    <Image x:Name="SelectedImage" Stretch="UniformToFill" />
                    
                    <!-- Empty State UI -->
                    <StackPanel x:Name="EmptyImagePlaceholder" VerticalAlignment="Center" HorizontalAlignment="Center" IsHitTestVisible="False">
                        <TextBlock Text="ðŸ“·" FontSize="32" Foreground="#A0AAB5" HorizontalAlignment="Center"/>
                    </StackPanel>

                    <!-- Hover Overlay (dimmed background + Replace Image text) -->
                    <Border x:Name="HoverOverlay" Background="#99000000" Visibility="Collapsed" IsHitTestVisible="False">
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Orientation="Horizontal">
                            <TextBlock Text="ðŸ–¼" FontSize="20" Foreground="White" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Add Image" FontSize="16" Foreground="White" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Title input with placeholder and character count -->
            <Grid Grid.Row="4" Margin="24,0,24,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="56"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8">
                    <Grid>
                        <TextBox x:Name="TitleTextBox" MaxLength="40" FontSize="14" VerticalContentAlignment="Center"
                                 Padding="12,0" BorderThickness="0" Background="Transparent"
                                 GotFocus="TitleTextBox_GotFocus" LostFocus="TitleTextBox_LostFocus"
                                 TextChanged="TitleTextBox_TextChanged"/>
                        <TextBlock x:Name="PlaceholderText" Text="Enter playlist title" FontSize="14" Foreground="#AAAAAA"
                                   VerticalAlignment="Center" Margin="12,0,0,0" IsHitTestVisible="False"/>
                    </Grid>
                </Border>
                <TextBlock x:Name="CharCountText" Grid.Row="1" Text="40" FontSize="12" Foreground="#AAAAAA"
                           HorizontalAlignment="Right" Margin="0,4,0,0"/>
            </Grid>

            <!-- Create button: pill-shaped, aligned with UI theme (blue-gray palette) -->
            <Button x:Name="CreateButton" Grid.Row="6" Content="Create" FontSize="14" FontWeight="SemiBold"
                    Foreground="White" Background="{StaticResource CreateButtonNormalBrush}" BorderThickness="0" Cursor="Hand"
                    HorizontalAlignment="Center" VerticalAlignment="Center" Padding="32,10" Margin="0,0,0,0"
                    Click="CreateButton_Click">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="BtnBorder" Background="{TemplateBinding Background}" CornerRadius="22"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource CreateButtonHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource CreateButtonDisabledBrush}"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </Grid>
    </Border>
</UserControl>
