<UserControl x:Class="Mei_Music.EditPlaylistPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:Mei_Music.Converters"
             mc:Ignorable="d">

    <UserControl.Resources>
        <!-- Local copy of converters used by this page so it can be loaded standalone. -->
        <converters:PathToImageSourceConverter x:Key="PathToImageSourceConverter" />

        <SolidColorBrush x:Key="PrimaryButtonNormalBrush" Color="#FF565C69"/>
        <SolidColorBrush x:Key="PrimaryButtonHoverBrush" Color="#FF474658"/>
        <SolidColorBrush x:Key="PrimaryButtonDisabledBrush" Color="#E5939EAA"/>
    </UserControl.Resources>

    <Grid Background="#FFE9ECF1">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FFE9ECF1" Padding="18,16,18,10">
            <TextBlock Text="Edit Playlist Info"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Foreground="#2C2F3B"/>
        </Border>

        <!-- Body -->
        <Grid Grid.Row="1" Margin="18,0,18,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="220"/>
            </Grid.ColumnDefinitions>

            <!-- Form -->
            <StackPanel Grid.Column="0" VerticalAlignment="Top">
                <TextBlock Text="Name" Foreground="#5B6472" FontSize="12" FontWeight="SemiBold" Margin="0,8,0,6"/>
                <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="10">
                    <TextBox Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             MaxLength="40"
                             FontSize="14"
                             Padding="12,10"
                             BorderThickness="0"
                             Background="Transparent"/>
                </Border>

                <TextBlock Text="Description" Foreground="#5B6472" FontSize="12" FontWeight="SemiBold" Margin="0,16,0,6"/>
                <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="10">
                    <TextBox Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="14"
                             Padding="12,10"
                             BorderThickness="0"
                             Background="Transparent"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             MinHeight="170"/>
                </Border>
            </StackPanel>

            <!-- Icon selector -->
            <StackPanel Grid.Column="2" VerticalAlignment="Top">
                <TextBlock Text="Icon" Foreground="#5B6472" FontSize="12" FontWeight="SemiBold" Margin="0,8,0,6"/>

                <Button Command="{Binding PickImageCommand}"
                        Background="Transparent"
                        BorderThickness="0"
                        Padding="0"
                        HorizontalAlignment="Left"
                        Cursor="Hand">
                    <Border Width="200"
                            Height="200"
                            Background="#F0F2F5"
                            CornerRadius="18"
                            ClipToBounds="True">
                        <!-- Match CreatePlaylistCard rounded masking and hover behavior -->
                        <Grid>
                            <Grid.OpacityMask>
                                <VisualBrush>
                                    <VisualBrush.Visual>
                                        <Border Background="Black" Width="200" Height="200" CornerRadius="18"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Grid.OpacityMask>

                            <!-- Actual Image -->
                            <Image Stretch="UniformToFill"
                                   Source="{Binding IconPreviewPath, Converter={StaticResource PathToImageSourceConverter}}"/>

                            <!-- Empty state: camera + Add Image text, hidden when an icon is present -->
                            <StackPanel x:Name="EmptyImagePlaceholder"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"
                                        IsHitTestVisible="False">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <!-- Hidden by default; shown only when IconPreviewPath is null/empty -->
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IconPreviewPath}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IconPreviewPath}" Value="">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>

                                <TextBlock Text="ðŸ“·"
                                           FontSize="34"
                                           Foreground="#A0AAB5"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Add Image"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="#7A8596"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,0"/>
                            </StackPanel>

                            <!-- Hover overlay for replacing the existing icon -->
                            <Border Background="#99000000"
                                    IsHitTestVisible="False">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=Button}}"
                                                         Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel VerticalAlignment="Center"
                                            HorizontalAlignment="Center"
                                            Orientation="Horizontal">
                                    <TextBlock Text="ðŸ–¼"
                                               FontSize="18"
                                               Foreground="White"
                                               Margin="0,0,8,0"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="Replace Image"
                                               FontSize="14"
                                               Foreground="White"
                                               FontWeight="Bold"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Border>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="2" Background="#FFE9ECF1" Padding="18,12,18,18">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Command="{Binding SaveCommand}"
                        Content="Save"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="White"
                        Background="{StaticResource PrimaryButtonNormalBrush}"
                        BorderThickness="0"
                        Cursor="Hand"
                        Padding="34,10"
                        Margin="0,0,14,0">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="BtnBorder"
                                    Background="{TemplateBinding Background}"
                                    CornerRadius="22"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource PrimaryButtonHoverBrush}"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter TargetName="BtnBorder" Property="Background" Value="{StaticResource PrimaryButtonDisabledBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>

                <Button Command="{Binding CancelCommand}"
                        Content="Cancel"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="#2C2F3B"
                        Background="Transparent"
                        BorderBrush="#D3D7DE"
                        BorderThickness="1"
                        Cursor="Hand"
                        Padding="34,10">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="BtnBorder"
                                    Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    CornerRadius="22"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="BtnBorder" Property="Background" Value="#08FFFFFF"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

